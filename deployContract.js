import { Web3 } from "web3"
import dotenv from "dotenv"
dotenv.config()

const web3 = new Web3(`https://sepolia.infura.io/v3/${process.env.INFURA_API_KEY}`)

const account1 = "0x390aF025B62BB6FaFeAF3c343C5FAB85CB702361"
// const account2 = "0x0c549dc11dD789A6ed360dF56903c1BA29625c20"

const acc1 = process.env.ACCOUNT1_PRIVATE_KEY
// const acc2 = process.env.ACCOUNT2_PRIVATE_KEY

const getBalance = async (acc) => {
    const bal = await web3.eth.getBalance(acc)
    console.log(`Balance of ${acc}: ${web3.utils.fromWei(bal, 'ether')} ETH`);
}


( async function deployContract (from, privateKey) {
    const feeData = await web3.eth.calculateFeeData();
    const nonce = await web3.eth.getTransactionCount(from);
    const data = "0x60806040526040518060400160405280600781526020017f5220546f6b656e000000000000000000000000000000000000000000000000008152505f908161004791906103d4565b506040518060400160405280600481526020017f52544b4e000000000000000000000000000000000000000000000000000000008152506001908161008c91906103d4565b506040518060400160405280600c81526020017f5220546f6b656e2076322e300000000000000000000000000000000000000000815250600290816100d191906103d4565b50600160065f6101000a81548160ff0219169083151502179055503480156100f7575f5ffd5b505f620f424090508060075f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055503360045f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550806003819055506103e8600581905550506104a3565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061021257607f821691505b602082108103610225576102246101ce565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026102877fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261024c565b610291868361024c565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f6102d56102d06102cb846102a9565b6102b2565b6102a9565b9050919050565b5f819050919050565b6102ee836102bb565b6103026102fa826102dc565b848454610258565b825550505050565b5f5f905090565b61031961030a565b6103248184846102e5565b505050565b5b818110156103475761033c5f82610311565b60018101905061032a565b5050565b601f82111561038c5761035d8161022b565b6103668461023d565b81016020851015610375578190505b6103896103818561023d565b830182610329565b50505b505050565b5f82821c905092915050565b5f6103ac5f1984600802610391565b1980831691505092915050565b5f6103c4838361039d565b9150826002028217905092915050565b6103dd82610197565b67ffffffffffffffff8111156103f6576103f56101a1565b5b61040082546101fb565b61040b82828561034b565b5f60209050601f83116001811461043c575f841561042a578287015190505b61043485826103b9565b86555061049b565b601f19841661044a8661022b565b5f5b828110156104715784890151825560018201915060208501945060208101905061044c565b8683101561048e578489015161048a601f89168261039d565b8355505b6001600288020188555050505b505050505050565b6120c7806104b05f395ff3fe60806040526004361061012d575f3560e01c806370a08231116100aa578063c311d0491161006e578063c311d04914610420578063d0febe4c14610448578063d2e8049414610452578063dd62ed3e1461047a578063f2fde38b146104b6578063f466a737146104de5761013c565b806370a082311461032a5780637ffdf53e146103665780638da5cb5b1461039057806395d89b41146103ba578063a9059cbb146103e45761013c565b806320b17a0a116100f157806320b17a0a1461023657806323b872dd146102725780635a3b7e42146102ae5780636c11bcd3146102d85780636f9fb98a146103005761013c565b806306fd9bf61461014057806306fdde031461017c578063095ea7b3146101a657806310049c5f146101e257806318160ddd1461020c5761013c565b3661013c5761013a6104f4565b005b5f5ffd5b34801561014b575f5ffd5b50610166600480360381019061016191906116d5565b610818565b604051610173919061170f565b60405180910390f35b348015610187575f5ffd5b5061019061082e565b60405161019d9190611798565b60405180910390f35b3480156101b1575f5ffd5b506101cc60048036038101906101c79190611812565b6108b9565b6040516101d9919061186a565b60405180910390f35b3480156101ed575f5ffd5b506101f66109a6565b604051610203919061186a565b60405180910390f35b348015610217575f5ffd5b506102206109b8565b60405161022d919061170f565b60405180910390f35b348015610241575f5ffd5b5061025c600480360381019061025791906116d5565b6109be565b604051610269919061170f565b60405180910390f35b34801561027d575f5ffd5b5061029860048036038101906102939190611883565b6109d4565b6040516102a5919061186a565b60405180910390f35b3480156102b9575f5ffd5b506102c2610c46565b6040516102cf9190611798565b60405180910390f35b3480156102e3575f5ffd5b506102fe60048036038101906102f991906116d5565b610cd2565b005b34801561030b575f5ffd5b50610314610fbf565b604051610321919061170f565b60405180910390f35b348015610335575f5ffd5b50610350600480360381019061034b91906118d3565b610fc6565b60405161035d919061170f565b60405180910390f35b348015610371575f5ffd5b5061037a610fdb565b604051610387919061170f565b60405180910390f35b34801561039b575f5ffd5b506103a4610fe1565b6040516103b1919061190d565b60405180910390f35b3480156103c5575f5ffd5b506103ce611006565b6040516103db9190611798565b60405180910390f35b3480156103ef575f5ffd5b5061040a60048036038101906104059190611812565b611092565b604051610417919061186a565b60405180910390f35b34801561042b575f5ffd5b50610446600480360381019061044191906116d5565b6111f1565b005b6104506104f4565b005b34801561045d575f5ffd5b50610478600480360381019061047391906116d5565b61132b565b005b348015610485575f5ffd5b506104a0600480360381019061049b9190611926565b611485565b6040516104ad919061170f565b60405180910390f35b3480156104c1575f5ffd5b506104dc60048036038101906104d791906118d3565b6114a5565b005b3480156104e9575f5ffd5b506104f26115e5565b005b60065f9054906101000a900460ff16610542576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610539906119ae565b60405180910390fd5b5f3411610584576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161057b90611a16565b60405180910390fd5b5f600554346105939190611a61565b90505f81116105d7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105ce90611aec565b60405180910390fd5b8060075f60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20541015610678576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161066f90611b54565b60405180910390fd5b8060075f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8282546106c49190611b72565b925050819055508060075f60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8282546107389190611ba5565b925050819055503373ffffffffffffffffffffffffffffffffffffffff167f3ceffd410054fdaed44f598ff5c1fb450658778e2241892da4aa646979dee6173483604051610787929190611bd8565b60405180910390a23373ffffffffffffffffffffffffffffffffffffffff1660045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8360405161080d919061170f565b60405180910390a350565b5f600554826108279190611a61565b9050919050565b5f805461083a90611c2c565b80601f016020809104026020016040519081016040528092919081815260200182805461086690611c2c565b80156108b15780601f10610888576101008083540402835291602001916108b1565b820191905f5260205f20905b81548152906001019060200180831161089457829003601f168201915b505050505081565b5f8160085f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92584604051610994919061170f565b60405180910390a36001905092915050565b60065f9054906101000a900460ff1681565b60035481565b5f600554826109cd9190611c89565b9050919050565b5f60075f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054821115610a1e575f5ffd5b60085f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054821115610aa2575f5ffd5b8160075f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f828254610aee9190611ba5565b925050819055508160075f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f828254610b419190611b72565b925050819055508160085f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f828254610bcf9190611ba5565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610c33919061170f565b60405180910390a3600190509392505050565b60028054610c5390611c2c565b80601f0160208091040260200160405190810160405280929190818152602001828054610c7f90611c2c565b8015610cca5780601f10610ca157610100808354040283529160200191610cca565b820191905f5260205f20905b815481529060010190602001808311610cad57829003601f168201915b505050505081565b5f8111610d14576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d0b90611d29565b60405180910390fd5b8060075f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20541015610d94576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d8b90611b54565b60405180910390fd5b5f60055482610da39190611c89565b90505f8111610de7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610dde90611d91565b60405180910390fd5b80471015610e2a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e2190611df9565b60405180910390fd5b8160075f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f828254610e769190611ba5565b925050819055508160075f60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f828254610eea9190611b72565b925050819055503373ffffffffffffffffffffffffffffffffffffffff166108fc8290811502906040515f60405180830381858888f19350505050158015610f34573d5f5f3e3d5ffd5b5060045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610fb3919061170f565b60405180910390a35050565b5f47905090565b6007602052805f5260405f205f915090505481565b60055481565b60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6001805461101390611c2c565b80601f016020809104026020016040519081016040528092919081815260200182805461103f90611c2c565b801561108a5780601f106110615761010080835404028352916020019161108a565b820191905f5260205f20905b81548152906001019060200180831161106d57829003601f168201915b505050505081565b5f8160075f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205410156110dc575f5ffd5b8160075f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8282546111289190611ba5565b925050819055508160075f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825461117b9190611b72565b925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516111df919061170f565b60405180910390a36001905092915050565b60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611280576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161127790611e87565b60405180910390fd5b478111156112c3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112ba90611eef565b60405180910390fd5b60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc8290811502906040515f60405180830381858888f19350505050158015611327573d5f5f3e3d5ffd5b5050565b60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146113ba576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016113b190611e87565b60405180910390fd5b5f81116113fc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016113f390611f7d565b60405180910390fd5b6005548103611440576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114379061200b565b60405180910390fd5b806005819055507f30408068166275ae85968bbf8ec71f9f7223948cb26781ed827b78a8f35f15b26005548260405161147a929190611bd8565b60405180910390a150565b6008602052815f5260405f20602052805f5260405f205f91509150505481565b60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611534576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161152b90611e87565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036115a2576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161159990612073565b60405180910390fd5b8060045f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b60045f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611674576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161166b90611e87565b60405180910390fd5b60065f9054906101000a900460ff161560065f6101000a81548160ff021916908315150217905550565b5f5ffd5b5f819050919050565b6116b4816116a2565b81146116be575f5ffd5b50565b5f813590506116cf816116ab565b92915050565b5f602082840312156116ea576116e961169e565b5b5f6116f7848285016116c1565b91505092915050565b611709816116a2565b82525050565b5f6020820190506117225f830184611700565b92915050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f61176a82611728565b6117748185611732565b9350611784818560208601611742565b61178d81611750565b840191505092915050565b5f6020820190508181035f8301526117b08184611760565b905092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6117e1826117b8565b9050919050565b6117f1816117d7565b81146117fb575f5ffd5b50565b5f8135905061180c816117e8565b92915050565b5f5f604083850312156118285761182761169e565b5b5f611835858286016117fe565b9250506020611846858286016116c1565b9150509250929050565b5f8115159050919050565b61186481611850565b82525050565b5f60208201905061187d5f83018461185b565b92915050565b5f5f5f6060848603121561189a5761189961169e565b5b5f6118a7868287016117fe565b93505060206118b8868287016117fe565b92505060406118c9868287016116c1565b9150509250925092565b5f602082840312156118e8576118e761169e565b5b5f6118f5848285016117fe565b91505092915050565b611907816117d7565b82525050565b5f6020820190506119205f8301846118fe565b92915050565b5f5f6040838503121561193c5761193b61169e565b5b5f611949858286016117fe565b925050602061195a858286016117fe565b9150509250929050565b7f436f6e76657273696f6e2069732063757272656e746c792064697361626c65645f82015250565b5f611998602083611732565b91506119a382611964565b602082019050919050565b5f6020820190508181035f8301526119c58161198c565b9050919050565b7f4d7573742073656e6420457468657220746f2062757920746f6b656e730000005f82015250565b5f611a00601d83611732565b9150611a0b826119cc565b602082019050919050565b5f6020820190508181035f830152611a2d816119f4565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f611a6b826116a2565b9150611a76836116a2565b9250828202611a84816116a2565b91508282048414831517611a9b57611a9a611a34565b5b5092915050565b7f496e76616c696420746f6b656e20616d6f756e740000000000000000000000005f82015250565b5f611ad6601483611732565b9150611ae182611aa2565b602082019050919050565b5f6020820190508181035f830152611b0381611aca565b9050919050565b7f4e6f7420656e6f75676820746f6b656e730000000000000000000000000000005f82015250565b5f611b3e601183611732565b9150611b4982611b0a565b602082019050919050565b5f6020820190508181035f830152611b6b81611b32565b9050919050565b5f611b7c826116a2565b9150611b87836116a2565b9250828201905080821115611b9f57611b9e611a34565b5b92915050565b5f611baf826116a2565b9150611bba836116a2565b9250828203905081811115611bd257611bd1611a34565b5b92915050565b5f604082019050611beb5f830185611700565b611bf86020830184611700565b9392505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680611c4357607f821691505b602082108103611c5657611c55611bff565b5b50919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b5f611c93826116a2565b9150611c9e836116a2565b925082611cae57611cad611c5c565b5b828204905092915050565b7f546f6b656e20616d6f756e74206d7573742062652067726561746572207468615f8201527f6e207a65726f0000000000000000000000000000000000000000000000000000602082015250565b5f611d13602683611732565b9150611d1e82611cb9565b604082019050919050565b5f6020820190508181035f830152611d4081611d07565b9050919050565b7f496e76616c696420457468657220616d6f756e740000000000000000000000005f82015250565b5f611d7b601483611732565b9150611d8682611d47565b602082019050919050565b5f6020820190508181035f830152611da881611d6f565b9050919050565b7f436f6e74726163742068617320696e73756666696369656e74204574686572005f82015250565b5f611de3601f83611732565b9150611dee82611daf565b602082019050919050565b5f6020820190508181035f830152611e1081611dd7565b9050919050565b7f4f6e6c79206f776e65722063616e20706572666f726d207468697320616374695f8201527f6f6e000000000000000000000000000000000000000000000000000000000000602082015250565b5f611e71602283611732565b9150611e7c82611e17565b604082019050919050565b5f6020820190508181035f830152611e9e81611e65565b9050919050565b7f496e73756666696369656e7420636f6e74726163742062616c616e63650000005f82015250565b5f611ed9601d83611732565b9150611ee482611ea5565b602082019050919050565b5f6020820190508181035f830152611f0681611ecd565b9050919050565b7f436f6e76657273696f6e2072617465206d7573742062652067726561746572205f8201527f7468616e207a65726f0000000000000000000000000000000000000000000000602082015250565b5f611f67602983611732565b9150611f7282611f0d565b604082019050919050565b5f6020820190508181035f830152611f9481611f5b565b9050919050565b7f436f6e76657273696f6e2072617465206d757374206e6f7420626520746865205f8201527f73616d652061732070726576696f757300000000000000000000000000000000602082015250565b5f611ff5603083611732565b915061200082611f9b565b604082019050919050565b5f6020820190508181035f83015261202281611fe9565b9050919050565b7f496e76616c6964206164647265737300000000000000000000000000000000005f82015250565b5f61205d600f83611732565b915061206882612029565b602082019050919050565b5f6020820190508181035f83015261208a81612051565b905091905056fea2646970667358221220c44c9a3641806f74546300beb6c55f859f40dd2d43c408b3f6eaea90bfe644d764736f6c634300081e0033";
     

    const estimatedGas = await web3.eth.estimateGas({ from, data });
    console.log(`Estimated gas for deployment: ${estimatedGas}`);
    const txObject = {
        from,
        data: data,
        nonce,
        gas: estimatedGas + 100000n, // Adding a buffer to the estimated gas
        maxFeePerGas: feeData.maxFeePerGas,
        maxPriorityFeePerGas: feeData.maxPriorityFeePerGas,
        type: 2, // EIP-1559 transaction
        chainId: 11155111, // Sepolia testnet chain ID
    }

    // Sign the transaction
    const signedTx = await web3.eth.accounts.signTransaction(txObject, `0x${privateKey.toString('hex')}`);
    
    // Broadcast the transaction
    const receipt = await web3.eth.sendSignedTransaction(signedTx.rawTransaction);

    // console.log("Transaction info:", receipt);
    
    console.log(`Transaction successful with hash: ${receipt.transactionHash}`);

    await getBalance(from);
})(account1, acc1)